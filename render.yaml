services:
  # 1. License Server (Web API)
  - type: web
    name: license-server
    env: python
    region: singapore # Optional, defaults to oregon
    plan: free # Optional
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn --chdir license_server app:app --bind 0.0.0.0:$PORT
    envVars:
      - key: ADMIN_API_KEY
        generateValue: true # Generates a secure random key if not set
      - key: CLIENT_SECRET
        generateValue: true
      - key: PYTHON_VERSION
        value: 3.10.0

  # 2. Discord Bot (Background Worker)
  - type: worker
    name: discord-bot
    env: python
    region: singapore
    buildCommand: pip install -r requirements.txt
    startCommand: python discord_bot/bot.py
    envVars:
      - key: DISCORD_TOKEN
        sync: false # User must input this in Dashboard
      - key: SERVER_URL
        fromService:
          type: web
          name: license-server
          property: url
      - key: ADMIN_API_KEY
        fromService:
          type: web
          name: license-server
          envVarKey: ADMIN_API_KEY
